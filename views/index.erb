<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8' />
    <title>Export Plans</title>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
    <script>
      $(function() {
        $('.racedate-form').submit(function() {
          $('#racedate-modal').modal('hide');
        });
      });
      function showRacedateModal() {
        $('#racedate-modal').modal('show');
      }
      function showgooglecallink() {
        $('#googlecal-link').show();
      }
    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body class='container-fluid'>
    <!-- Modal -->
    <div class="modal fade" id="racedate-modal" tabindex="-1" role="dialog" aria-labelledby="racedateLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="racedateLabel">Enter the date of your race</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="racedate-form" method="GET" action=<%"/"+plan%>>
              <div class="form-group">
                <input type="date" name="racedate" required>
                <button type="submit" class="btn btn-primary">Submit</button>
              </div>
          </form>
          </div>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-dark bg-dark">
      <span class="navbar-brand mb-0 h1"><a href="/">Export a Hal Higdon plan</a></span>
    </nav>
    <div class="row"  style="margin-top:2%">
      <div class="col-sm-5 text-center" >
        <div  style="margin-top:5%" class="btn-group" role="group" aria-label="Button group with nested dropdown">
          <button class="btn btn-primary" id="novice-1-button">Novice 1</button>
          <div class="btn-group" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              View
            </button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
              <a class="dropdown-item" href="/full-novice-1">Original Grid</a>
              <a class="dropdown-item" onclick="showRacedateModal()">Grid for Race Date</a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-7">
        <div class="card text-center" style="width: 75%;">
          <h5 class="card-header"><%= table_title %></h5>
          <div class="card-body">
            <div class="btn-group" role="group">
              <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Export
              </button>
              <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                <% if racedate != '' %>
                <a class="dropdown-item" href=<%="/"+plan+"?csv=true&racedate="+racedate%>>Export as CSV</a>
                <a class="dropdown-item" onclick="showgooglecallink()" href=<%="/"+plan+"?csv=true&calendar=true&racedate="+racedate%>>Export as Google calendar-importable CSV</a>
                <% else %>
                <a class="dropdown-item" href="/"+plan+"?csv=true">Export as CSV</a>
                <% end %>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div style="min-height:40px">
                  <a id="googlecal-link" style="display:none" target="_blank" href="https://support.google.com/calendar/answer/37118?hl=en">
                    How to upload a CSV to a Google Calendar
                  </a>
                </div>
              </div>
            </div>
            <h5 class="card-title" style="min-height:20px">
              <% if racedate != '' %>
                Race Date: <%= racedate %>
              <% end %>
            </h5>
            <table style="width:100%">
              <tr>
                <% for cell in week_header %>
                  <th>
                    <%= cell %>
                 </th>
               <% end %>
              </tr>
              <% for row in rows %>
               <tr>
                 <% for cell in row %>
                   <td>
                     <%= cell %>
                  </td>
                <% end %>
              </tr>
             <% end %>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12"
    </div>
  </body>
</html>
